# 共有資源やキャッシュに関する問題
Webアプリケーションは複数の要求を同時に受け付けることから、平行プログラミングの問題、とくに共有資源の取り扱いに関する問題が発生する場合がある。
また、複数の要求を同時に多数処理するためにキャッシュの技術が多用される。
- 共有資源の扱い不備に起因する代表的な脆弱性
  - 競合状態(Race Condition)
- キャッシュの取り扱い不備に起因する脆弱性
  - キャッシュからの情報漏洩

# 競合状態の脆弱性
## 概要
共有資源とは、複数のプロセスやスレッドから同時に利用している変数、共有メモリ、ファイル、データベースなどのこと。
共有資源に対する排他制御が不十分な場合、競合状態の脆弱性の原因となる場合がある。
競合状態の脆弱性の影響は以下の通り
- 別人の個人情報などが画面に表示される(別人問題)
- データベースの不整合
- ファイルの内容の破壊

## 脆弱性が生まれる原因
- 変数nameは共有変数である
- 共有変数nameの排他制御をしていない
サーブレットクラスのインスタンス変数が共有資源であることを知らないと、うっかり犯しがちなミスであると言える

## 対策
- 可能であれば共有資源を使用しない
- 共有資源に対して排他制御を行う

## まとめ
排他制御は、データベースのロックという形でおなじみですが、それ以外に共有変数やファイルでも必要な場合がある。
共有資源はできるだけ使わないことが性能その他の点でも有利だが、必要があって共有資源を利用する場合は、排他的な処理をできるだけ短時間に終わらせる設計が求められる。

# キャッシュからの情報漏洩
## 概要
Webアプリケーションは処理の高速化やサーバー負荷の軽減のために多くの箇所でキャッシュの記述を使う。
キャッシュは有効な技術だが、過剰にキャッシュが働いてしまうと、個人情報漏洩などの原因になる場合がある。

## 脆弱性が生まれる原因
- アプリケーション側のキャッシュ制御不備
- キャッシュサーバの設定不備
キャッシュからの情報漏洩の原因は、不適切なキャッシュ制御にあり、典型的には「キャッシュすべきでないリソースをキャッシュした」ことが原因となる。
具体的には、閲覧に認証を必要とする情報表示や、ユーザ毎に表示内容が異なる個人情報が該当する。

## 対策
キャッシュ機能を提供するものとしては、リバースプロキシに加えてCDNやロードバランサーなども含まれるため、これらを管理するインフラ担当者との緊密な連携が必要になる場合がある。
対策とは以下の両方を実施すること
- アプリケーション側でキャッシュ制御用の適切なレスポンスヘッダを設定する
- キャッシュサーバ側でキャッシュ制御の適切な設定を行う

## まとめ
キャッシュ技術を使う場合には、キャッシュの範囲や期間などを要件にあわせて適切に設計、実装することが重要
