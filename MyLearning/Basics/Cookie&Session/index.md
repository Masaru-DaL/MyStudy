# CookieとSessionの違いとは

## 1. CookieとSessionの概要

### 1-1. なぜCookieとSessionが存在するのか

**HTTP通信がステートレスなプロトコルで「状態」を持てないため**
状態とは何を指すのか。
一例だが、ログインした後の状態とする。
ログインした後、ページを閉じて、開くとまたログインしなくてはいけないというのは面倒すぎる。これを解決してくれるのがCookieとSessionである。

### 1-2. CookieとSessionの関係

この2つの関係を間違えてはいけない。
**Cookieを使って、Session状態を保持する**

## 2. Cookie

正式名称は「HTTP Cookie」だが、単にCookieとも表記されるので、Cookieと表記されていたらHTTP Cookieのことだと思って良い。

Cookieとは、HTTPにおけるブラウザとサーバの間で用いられる**ウェブブラウザに保存された情報のこと**を指す。ユーザ識別やセッション管理を実現する目的などに利用される。

参照: [HTTP Cookie](https://ja.wikipedia.org/wiki/HTTP_cookie)

### 2-1. Cookieの特徴

勘違いしていたが、ログインしていなくてもCookieは発行されている。そこの所を理解する。

#### 2-1-1. そもそもCookieって何を指すの？

Cookieとは、情報を発行する仕組み・またはそのデータを指す。データを指す場合、それは**テキストファイル**である。そして、そこに格納できるデータは**どんな情報**でも格納できる。
しかし、**多くの場合は個人情報を保存している**という扱いをされる。

#### 2-1-2. Cookie発行までの流れ

1. ブラウザからWebサーバにアクセスする(初回アクセス時)
2. Webサーバはブラウザへ、**そのWebサーバ専用のCookieファイルを作成する**(ブラウザへ発行する)
3. 次回ブラウザがWebサーバへアクセスした際に、ブラウザは発行されたCookieをWebサーバへ送信する。
4. WebサーバはCookie情報を読み取る。この時、WebサーバにもブラウザのCookie情報は保存されているので、照らし合わせ、該当ブラウザと判断する。

#### 2-1-3. ブラウザからサーバへ Cookieの送信について

* Cookieは、サーバにアクセスする度に自動送信される。
という事は**ブラウザ側にデータを保存する仕組みがある**ということ。

* Cookieは受け取ったサーバにしか送らない。
ブラウザがCookieをサーバから受け取った後、**受け取ったサーバとは異なるWebサーバに対してはCookieを送らない**。

#### 2-1-4. Cookieの取り扱い

* ログインなどによってCookieの値は更新される場合もある。
* Cookieの値は有効期限が設けられている。
* ブラウザでCookieの仕組みを有効か無効か選ぶ事ができる。
* 便利な反面、Cookieの取り扱いに注意喚起を鳴らす声もある。

## 3. Storage

ブラウザからサーバへCookieを送信するが、ブラウザ側にCookieを保存しておく仕組みがあるという事がわかる。ブラウザ側でCookieを保存する仕組みについて調べる。

### 3-1. ブラウザで保存する仕組みの種類

* ブラウザでデータを保存する仕組みは、HTML4.1以前はCookieの仕組みしかなかった。
保存容量が4KBと少ないことや、全てのリクエストに対してサーバにデータを自動で送信するため、容量制限やセキュリティ対策に悩まされる事が多々あった。

* HTML5でCookieに代わるデータ保存の仕組みとして「**Web Storage**」と呼ばれる機能が利用できるようになった。
WebStorageには、ブラウザ側でKey-Value型でデータ保存する機能がある。また、WebStorageには「
 Session Storage」と「LocalStorage」の2種類がある。CookieとWebStorageの大まかな違いは以下の表の通り。

|                | 別Windowでのデータ共有 | データの有効期限           | データ量の上限     | サーバへのデータ送信           | 操作  |
| -------------- | -------------- | ------------------ | ----------- | -------------------- | --- |
| Cookie         | ○              | 指定期限まで有効(任意に設定が可能) | 4KB         | サーバへアクセスするたびに毎回自動送信  | サーバサイド言語が多い(phpなど)    |
| SessionStorage | ×              | ウィンドウやタブを閉じるまで有効   | 1オリジンあたり5MB | 必要時のみスクリプトやフォームなどで送信 | JSのみ    |
| LocalStorage   | ○              | 永続的に有効             | 1オリジンあたり5MB | 必要時のみスクリプトやフォームなどで送信 | JSのみ    |

### 3-2. CookieとWebStorageの比較検討
