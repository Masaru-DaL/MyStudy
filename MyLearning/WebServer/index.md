# WebServer

## 1. WebServerの歴史

参考: [Wikipedia WebServer](https://ja.wikipedia.org/wiki/Web%E3%82%B5%E3%83%BC%E3%83%90)

| 年数               | 出来事                                                  |
| ---------------- | ---------------------------------------------------- |
| 1989年            | CERNに在籍していたティム・バーナーズ=リーがWebシステムの素案を目に見える形で提案         |
| 1990年11月         | World Wide Webをより具体化した提案書を発表                         |
| 1990年11月13日      | Webシステムの開発が開始                                        |
| 1990年12月~1991年1月 | クリスマス休暇中に現在のWebサーバ群の基になるHTTPサーバ「CERN httpd」と各種ツールを作成 |
| 1991年8月          | WWWとWebサーバのデビュー プロジェクト成果の要約をニュースグループに投稿              |
| 1992年            | CERN httpdに続く2番目の実装とるなる「NCSA HTTPd」を開発               |
| 1993年            | 画像も表示できるウェブブラウザNCSA Mosaicを開発                                                     |

* **1991年8月にWWWとWebサーバがデビューした**
* **1992~1993年で一般に急速に広まった**
この時点でのWebサーバの主役は「CERN httpd」「NCSA HTTPd」だったが、改修が進まないという不満が募り、「NCSA HTTPd」に修正を加えるためのパッチを集積するプロジェクトが始まった。そして、このプロジェクトに「**Apache Group**」という名前が付けられた。このプロジェクトでNCSA HTTPdのメンテを主目的としたNCSA HTTPdの派生版の「**Apache HTTP Server**」が誕生し、こちらに主役を移すことになった。

* 2015年時点のWebServerの市場
Apache(派生版含む): 4割
IIO(MicroSoft): 3割
nginx: 2割弱

## 2. Server と WebServer

Server ≒ WebServer
Sever, WebServer: ハードウェアを指す場合もあるし、ソフトウェアを指す場合もある
肌感的にはServer=ハードウェア, WebServer=ソフトウェアを指す感じはする。
基本的にWebサーバはソフトウェアを指すものとする。

### 2-1. WebServerとは

* Webサーバは**Webサイトを公開するため**に必要なもの。
いくら頑張ってWebアプリ、Webサイトを作ってもWebサーバがなければ公開できない。

* クライアントサーバモデルのサーバを指す

1. Webクライアント(ブラウザ)を使ってWebサイトにアクセスする
2. WebクライアントからのリクエストをWebサーバで受け取る
3. Webサーバは、リクエストに応じて「HTML」や「画像」などのデータを探す
4. Webサーバは、データをWebクライアントにデータをレスポンスする

* クライアントからのリクエストの種類によって動作が異なる
  + 静的ウェブサーバ
    - 静的コンテンツの場合はWebサーバでレスポンスを返す。
  + 動的ウェブサーバ
    - 動的コンテンツの場合はアプリケーションサーバに必要なデータをリクエストする。アプリケーションサーバから必要データを受け取った後、クライアントにデータをレスポンスする。

### 2-2. WebServerがリクエストを処理するプロセス

#### 2-2-1. WebServerはリクエストを返すためのファイルを格納する必要がある。

リクエスト/レスポンスで応答するものは全てファイルとして考える。

 1. HTML文書およびその関連資産である画像
 2. CSSスタイルシート
 3. JavaScriptファイル
 4. フォント
 5. 動画など
※**自分のコンピュータでも可能だがWebサーバに全てを格納したほうがはるかに便利であるため**。

#### 2-2-2. HTTP通信

* HTTPについて気をつける点

 1. **サーバはクライアントのHTTPリクエストに応答することだけができる**
 2. クライアント(ブラウザ)は、HTTPでファイルをリクエストする時にURLを示さなければならない
 3. サーバは全てのHTTPリクエストに応える必要がある。処理できない場合でもエラーメッセージを返す必要がある。

* Webサーバがリクエストを受信した時

1. サーバは最初にリクエストされたURLが既存にファイルに一致するかどうかをチェックする。
2. 一致するファイルがあった場合、ブラウザにファイルを送り返す。なかった場合、アプリケーションサーバが必要なファイルを作成する。
3. どちらの処理もできなかった場合、エラーメッセージ(404)をブラウザに返す。

#### 2-2-3. アプリケーションサーバ(APサーバ)

Webサーバがリクエストを処理する際に、リクエストに一致したファイルがなかった場合にアプリケーションサーバが必要なファイルを作成する。これは、動的コンテンツのリクエストに対応しているという事である。

参考: [Web3層構造 image](https://www.infraexpert.com/infogif/server41.gif)

> APサーバは**Webサーバからの要求を受けてプログラムを実行**したり、必要に応じて**DBサーバへの問い合わせや書き込み処理**をし、処理結果をWebサーバへ提供する役割を担っている。

## 3. WebServerの種類

よく使われるのは**Apache**, **Nginx**, **IIS**の3種類で、この3種類だけで全体の80％近くのシェアを占める。

参照: [W3Techs.com](https://w3techs.com/technologies/overview/web_server)

### 3-1. Apache

正式名称: **Apache HTTP Server**
イギリスのApacheソフトウェア財団が保持している。歴史的経緯は、1章を参照。

* OSS
* LinuxOSに採用されている
* マルチスレッド
  + 動的なコンテンツの処理に適していて、CGIやPHPなどに向いている
* 色々なアプリやソフトを利用する際に、比較的簡単な設定で済む
* 約20年間利用されていて、バージョンアップが続いているため、信頼性が高い
* メモリを多めに消費するので、アクセス増加によりメモリが足らなくなることもある

### 3-2. Nginx

読み方: **エンジンエックス**
アメリカのサンフランシスコに本社をかまえるNGINX, Inc.によって開発され、2002年に登場した比較的新しいWebサーバ。

* OSS
* 開発者にとても人気がある
* Apacheより速くて高負荷に強い
  + 設計段階からApacheが苦手な大容量データ配信や大量同時接続に耐えることを目的に作られたため
  + 同時接続数がApacheの10~100倍にも耐えられる(ノンブロッキングI/Oと非同期のイベント駆動アーキテクチャという仕組みによるもの)
* シングルスレッド
  + 静的コンテンツを扱うのに適する
  + キャッシュサーバ不要でHTMLや画像などをキャッシュできる
* CPUを使う作業に比較的弱い

### 3-3. IIS(Internet Information Services)

Windows用のWebサーバ機能のこと。WindowsNT 3.51のアドオンとして1995年に提供が開始された。Microsoft社が提供しているため、Windowsに特化している。

* OSSではない
* 操作はGUIで行う
  + Linuxなどのようにコマンドを扱う必要がない
* 動的なWebページを手軽に作成できるので、Webアプリケーションを効率よく開発できる
* 今回の3種類の中では比較的難易度は優しめで、初めて利用する人でも使いやすい

## 4. サーバの提供の種類

サーバ会社からサーバを借りる際のサービスの違いなどについて調べる。自分でWebサーバを構築することも出来るが、基本的にはサーバを提供するサービスを利用するものとする。

1. 物理サーバとして、**共有サーバ**と**専有サーバ**というサービス提供の違いがある。
2. 物理サーバ上に仮想的に作られたユーザごとの専用領域を**仮想専有サーバ(VPC)**と呼ぶ。
3. インターネット上で提供するコンピュータ機能を利用する仕組みを**クラウドコンピューティング**と言い、その中のサービスの1つで**クラウドサーバ**を提供している。

### 4-1. 共有サーバ/専有サーバ/仮想専有サーバ(VPS)の比較

|               | 共有サーバ                                  | 専有サーバ                                | 仮想専有サーバ(VPC)             |
| ------------- | -------------------------------------- | ------------------------------------ | ------------------------ |
| **特徴**        | 1台のサーバを複数のユーザで利用する                     | 1台のサーバを1人で専有して利用する                   | 1台のサーバを複数ユーザで利用する仮想専用サーバ |
| **メリット**      | <li>コストが安い</li><li>専門知識が不要</li>        | <li>リソースを専有できる</li><li>カスタマイズ可能</li> | <li>共有サーバより自由度が高い</li><li>専有サーバのようなスペックを安価に利用可能</li>                     |
| **デメリット**     | <li>自由度が低い</li><li>他のユーザの影響を受けやすい</li> | <li>コストがかかる</li><li>専門知識が必要</li>     | <li>専有サーバほど自由度がない</li><li>専門知識がある程度必要</li>                         |
| **向いている人・企業** | 個人利用・小規模企業                             | 上級者・大企業向け                            | 上級者、中規模企業向け                         |

### 4-2. クラウドサーバ

レンタルサーバと同様にネットワークを通じてサーバ会社からサーバを借り受けできるサービス。クラウドサーバは、インターネット上にある**仮想サーバ**の事を指す。

#### 4-3. クラウドサーバとVPSの違い

|               | クラウドサーバ                                | VPS                                        |
| ------------- | -------------------------------------- | ------------------------------------------ |
| **共通部分**              | 仮想サーバ                                       | 仮想サーバ                                           |
| **使用可能なリソース** | <li>自由</li><br>契約解除することなく必要なリソースに変更が可能 | <li>固定</li><br>リソースを変更したい場合は一度契約を解除する必要がある |
| **契約台数**      | 複数台契約が可能                               | 1台契約                                       |
| **月額コスト**     | 重量課金(豊富な機能から取捨選択できる)                   | 月額固定料金(コストを抑えることが可能だが、機能は豊富ではない)           |
| **特徴**            | 急激なアクセス不可の応じたリソースの増減が可能                | 急なアクセス負荷時などに対応できない<br>前もってサーバの負荷を想定する必要がある |
