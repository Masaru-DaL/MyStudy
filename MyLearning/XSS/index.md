# XSSとは

こちら記事では、「XSS(クロスサイトスクリプティング)」について解説します。

XSSとは、セキュリティ的欠陥のあるWebサイトが攻撃者によって狙われ、ユーザが被害に遭う**サイバー攻撃の1種**です。XSSの正式名称は「Cross Site Scripting」ですが、初期に発見されたXSSが「複数サイトをまたがって攻撃すること」や、カスケーディングスタイルシートの「CSS」と混同しないようにXSSという略称で呼ばれています。

こちらの記事を通して、XSSの正しい知識と対策を学習しましょう。

## なぜXSSの対策を行わなければならないのか

対策を行う主な理由は2つあり、**現在のWeb開発の需要**と**被害の多さ**にあります。

### 現在のWeb開発の需要

Webサイトには静的Webサイトと動的Webサイトの2種類があり、需要が拡大しているのが**動的Webサイト**です。現在のECサイトやSNSは、個々のユーザの趣味や嗜好に合わせたWebサイトを提供しています。

動的Webサイトはユーザに合わせて動的にHTMLなどを生成するので、悪意を持ったユーザによって攻撃されてしまう可能性を持っています。

### XSSにおける被害状況

[IPA: 情報処理推進機構](https://www.ipa.go.jp/)は、[ソフトウェア等の脆弱性関連情報に関する届出状況](https://www.ipa.go.jp/security/vuln/report/press.html)という情報を公開しています。

Webサイトの脆弱性の種類別の届出状況において、XSSは**常に一定以上の割合(2022年は58％)の届出が出されている**状況です。このため、Web開発においてXSSは必ず意識して対策を行わなければなりません。

参照: [ソフトウェア等の脆弱性関連情報に関する届出状況 2022年第2四半期(4月~6月)](https://www.ipa.go.jp/files/000099955.pdf)

## XSSの攻撃手法とそれによる被害

XSSの主な攻撃手法は3つあります。

1. 反射型XSS(非持続的)
2. 格納型XSS(持続的)
3. DOMベースのXSS

上記の攻撃手法の詳細と、攻撃により遭う被害、攻撃の対策を解説していきます。

参考: [攻撃手法の分類](https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%AD%E3%82%B9%E3%82%B5%E3%82%A4%E3%83%88%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0#:~:text=%E5%AE%9F%E8%A1%8C%5B3%5D-, %E5%80%8B%E4%BA%BA%E6%83%85%E5%A0%B1%E3%81%AE%E5%A5%AA%E5%8F%96%5B%E7%B7%A8%E9%9B%86%5D, -%E6%94%BB%E6%92%83%E8%80%85%E3%81%AF)

### 反射型XSS(非持続的)

反射型XSSの攻撃手段として分かりやすいのが「**フィッシング詐欺**」と呼ばれるものです。

まず攻撃者は、偽Webサイトや偽メールに**不正なスクリプトを含んだリンクを用意**します。ユーザは気付かずに**不正なスクリプトを含んだリンクをクリックする**ことで、攻撃者の用意した**脆弱性のあるWebサイトに誘導**されてしまいます。この攻撃によって、**個人情報を盗まれたり、不正プログラムに感染してしまいます**。

不正なスクリプトを含んだリンクをクリックしたことで、サーバにリクエストを送ったことになります。そして悪意のあるプログラムがレスポンスとして返って来ます。リクエストした人に攻撃が反射して返って来る、という意味から「反射型XSS」と呼ばれています。

**反射型XSSの図の挿入予定**

### 格納型XSS(持続的)

格納型XSSは、攻撃者が脆弱性のあるWebサイトの内部に悪意のあるプログラムを仕込む(格納する)ことから「格納型XSS」と呼ばれています。

悪意のあるプログラムが仕込まれたWebサイトを閲覧するだけで、攻撃が実行されてしまいます。

**個人情報を盗まれたり、不正プログラムに感染してしまう点**は、反射型XSSと同じですが、攻撃者によって仕込まれた悪意のあるプログラムを取り除かないと**永久(持続的)に攻撃が行われてしまいます**。

**反射型XSSの図の挿入予定**

### DOMベースのXSS

DOMは「Document Object Model」のことで、簡単に説明すると**プログラムからHTMLなどを自由に操作するための仕組みのこと**です。**DOMの仕組みを悪用する**ことからDOMベースのXSSと呼ばれます。
DOMのイメージが中々付かなくて難しく感じると思いますが、Web開発者にとって必ず知っておくべき攻撃ですので、なるべく分かりやすく説明していきます。

Web開発者はブログサイトを作成し、投稿された日記に対して**自由にコメントを付けられるように入力フォームを用意しました**。Web開発者が想定した、入力フォームに入力されるものは「素敵ですね！」や、「私も◯月◯日にそこに行きました！」などの**文字や数字**でした。

しかし、悪意のある攻撃者は入力フォームに `<script>alert(document.cookie)</script>` というスクリプトを入力しました。内容は**Cookieの値をポップアップで表示させる**というものです。 (Cookieには、セッションIDという、**ログイン時に発行され、ログインしたユーザを識別する番号**が含まれています。)

つまり、このスクリプトを入力されたことで、**本来のCookieの値の持ち主になりすまされ、個人情報を盗まれるなどの被害に遭う可能性があります。**
このような、Webサイト上のCookieなどの個人情報を不正に入手するサイバー攻撃のことを**セッションハイジャック**と呼びます。

**反射型XSSの図の挿入予定**

## XSSの対策

XSSには3種類ありますが、どれか1つだけにだけ対策するのではなく、全ての攻撃に対して対策しなければなりません。

### Web開発における対策

1. エスケープ処理・サニタイズ
悪意のあるスクリプトを埋め込まれても無効化することができます。

* 「<」 -> &lt;
* 「>」 -> &gt;
* 「"」 -> &quot;
* ...

上記のように文字を置き換えることを**エスケープ処理**といい、XSSのようなサイバー攻撃につながるような文字を無効化することを**サニタイズ**といいます。

エスケープ処理を行うと、入力フォームに「 `<script>` 」と打ち込まれても、「 `&lt;script&gt;` 」という無害な文字列に置き換えることができます。

2. バリデーション処理(入力値の制限)

### ブラウザなどの設定における対策

## まとめ

XSSは、セキュリティ的欠陥のあるWebサイトが標的になりますが、被害に遭うのはWebサイトを運営する側ではなく、**その先にいるエンドユーザ(利用するユーザのこと)です**。
